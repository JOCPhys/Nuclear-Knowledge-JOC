{% extends "base.html" %}

{% block title %}{{ topic.title }}{% endblock %}

{% block content %}
<h1>{{ topic.title }}</h1>
{% if topic.image %}
    <img src="{{ topic.image.url }}" alt="{{ topic.title }}" class="img-fluid">
{% else %}
    <img src="{% static 'images/placeholder.png' %}" alt="Placeholder Image" class="img-fluid">
{% endif %}
<p>{{ topic.content|safe }}</p>
<p><small class="text-muted">By {{ topic.author }} on {{ topic.created_at }}</small></p>
<p><small class="text-muted">{{ topic.comments.count }} comments</small></p>
<p class="card-text" id="like-count-{{ topic.pk }}"><small class="text-muted">{{ like_count }} likes</small></p>
<button class="btn btn-outline-primary like-button" data-topic-id="{{ topic.pk }}">
    {% if user in topic.likes.all %}
        Unlike
    {% else %}
        Like
    {% endif %}
</button>
<h3>Comments</h3>
<ul>
    {% for comment in comments %}
    <li>
        <p>{{ comment.body|safe }}</p>
        <p>By {{ comment.author.username }} on {{ comment.created_at }}</p>
        {% if comment.author == user %}
            <form method="post" action="{% url 'delete_comment' comment.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
        {% endif %}
    </li>                
    {% endfor %}
</ul>
<h5>Add a Comment</h5>
<form method="post" class="mb-4">
    {% csrf_token %}
    <div class="form-group">
        {{ form.body }}
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary">Add Comment</button>
        <a href="{% url 'topic_page' %}" class="btn btn-secondary">Return to Topics</a>
    </div>
</form>
{% endblock %}